<nav class="navbar">
  <div class="navbar__inner">
    <div class="navbar__left">
      <button
        class="icon-button"
        type="button"
        (click)="toggleDrawer()"
        [attr.aria-expanded]="drawerOpen"
        aria-controls="nav-drawer"
      >
        <span class="sr-only">Abrir menu principal</span>
        <svg width="26" height="18" viewBox="0 0 24 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 16H24V13.3333H0V16ZM0 9.33333H24V6.66667H0V9.33333ZM0 0V2.66667H24V0H0Z" fill="#F2EFE9" />
        </svg>
      </button>
      <div class="brand">
        <a routerLink="/" class="brand__title">Nome do projeto</a>
        <span class="brand__subtitle">Experiências guiadas e personalizadas</span>
      </div>
    </div>
    <div class="navbar__right">
      <a class="chip-link" routerLink="/menu-general">Catálogo</a>
      <a class="chip-link chip-link--ghost" routerLink="/support">Suporte</a>
      <div class="user-shell">
        <a routerLink="/user" class="avatar-wrapper">
          <ng-container *ngIf="(avatar.avatarUrl$ | async) as imageSrc; else emoji">
            <img [src]="imageSrc" alt="Avatar do usuário" />
          </ng-container>
          <ng-template #emoji>
            <span>{{ (avatar.emoji$ | async) }}</span>
          </ng-template>
        </a>
        <div class="user-meta" *ngIf="userName; else loginLink">
          <div class="user-text">
            <span>Bem-vindo,</span>
            <strong>{{ userName }}</strong>
          </div>
          <button type="button" class="logout-button" (click)="logout()">Logout</button>
        </div>
      </div>
      <ng-template #loginLink>
        <a routerLink="/login" class="login-pill">Entrar</a>
      </ng-template>
    </div>
  </div>
</nav>

<div
  *ngIf="drawerOpen"
  class="drawer-overlay"
>
  <button
    type="button"
    class="drawer-backdrop"
    (click)="toggleDrawer(false)"
    aria-label="Fechar menu lateral"
  ></button>
  <aside class="drawer-panel" id="nav-drawer" role="dialog" aria-modal="true">
    <header class="drawer-header">
      <div>
        <p class="eyebrow eyebrow--compact">Explore o catálogo</p>
        <h3>
          {{ showExcursions ? (selectedCategory === 'viagem' ? 'Viagens' : 'Passeios') : 'Selecione uma categoria' }}
        </h3>
      </div>
      <button class="icon-button icon-button--light" type="button" (click)="toggleDrawer(false)">
        <span class="sr-only">Fechar menu</span>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18" stroke="#0c3c35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M6 6L18 18" stroke="#0c3c35" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </header>

    <div class="drawer-body" *ngIf="!showExcursions; else excursionsTemplate">
      <button
        class="drawer-option"
        type="button"
        *ngFor="let option of menuOptions"
        (click)="onMenuOptionClick(option)"
      >
        <div>
          <span class="option-title">{{ option.name }}</span>
          <span class="option-description">{{ getMenuOptionDescription(option) }}</span>
        </div>
        <span class="option-arrow" aria-hidden="true">→</span>
      </button>
    </div>

    <ng-template #excursionsTemplate>
      <div class="drawer-body">
        <button type="button" class="back-link" (click)="goBackToMenu()">← Voltar</button>
        <div *ngIf="isLoadingExcursions" class="drawer-loading">
          Carregando experiências...
        </div>
        <p class="drawer-error" *ngIf="drawerError">{{ drawerError }}</p>
        <ul class="drawer-list" *ngIf="!isLoadingExcursions && !drawerError">
          <li *ngIf="locations.length === 0" class="drawer-empty">
            Nenhum {{ selectedCategory === 'viagem' ? 'viagem' : 'passeio' }} disponível no momento.
          </li>
          <li *ngFor="let location of locations; trackBy: trackByLocation">
            <button type="button" (click)="navigateToExcursion(location)">
              <span>
                {{ location.name }}
                <small *ngIf="location.location"> · {{ location.location }}</small>
              </span>
              <small *ngIf="location.price">
                R$ {{ location.price | number:'1.2-2' }}
              </small>
            </button>
          </li>
        </ul>
      </div>
    </ng-template>
  </aside>
</div>
